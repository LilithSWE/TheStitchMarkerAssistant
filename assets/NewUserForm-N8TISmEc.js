import{u as L,r as d,j as e}from"./index-t8r2_LHW.js";import{B as g}from"./Button-BwEmg0zX.js";import{H as T}from"./Headline-CwRnmAIK.js";import{v as B}from"./validateEmail-BIDw8Q-C.js";import{v as b}from"./validatePassword-5G1YVJAs.js";import{s as P}from"./supabaseClient-DEXQobeG.js";import{P as S}from"./PopUp-CeSf8eW7.js";import{L as N}from"./Loader-DKMNs3v0.js";const q=()=>{const x=L(),a=document.getElementById("errorMsg"),[r,j]=d.useState({username:"",email:"",password:""}),[w,y]=d.useState(!1),[I,l]=d.useState(!1),[E,c]=d.useState(!0),u=t=>{j({...r,[t.target.name]:t.target.value}),t.target.classList.remove("error"),c(!0)},C=(t,n,o)=>{if(a){if(t!=""&&n&&o)return;if(c(!1),a.innerText="Please edit in the following fields: [",t==""){a.innerText+="Name, ";const s=document.getElementById("regNameInput");s==null||s.classList.add("error")}if(!n){a.innerText+="Email, ";const s=document.getElementById("regEmailInput");s==null||s.classList.add("error")}if(!o){a.innerText+="Password";const s=document.getElementById("regPasswordInput");s==null||s.classList.add("error")}a.innerText+="]"}},h=()=>{const t=B(r.email),n=b(r.password);if(r.email===""&&r.password===""&&r.username===""){c(!1),a&&(a.innerText="Please write something in the fields above.");const o=document.getElementById("regNameInput");o==null||o.classList.add("error");const s=document.getElementById("regEmailInput");s==null||s.classList.add("error");const i=document.getElementById("regPasswordInput");i==null||i.classList.add("error");return}C(r.username,t,n),r.username!=""&&t&&n&&v(r.username,r.email,r.password)},v=async(t,n,o)=>{var f;l(!0);const{data:s,error:i}=await P.auth.signUp({email:n,password:o,options:{data:{first_name:t},emailRedirectTo:"https://lilithswe.github.io/TheStitchMarkerAssistant/#/confirm"}});i&&(console.error("Error signing in:",i.message),a&&(a.innerText=i.message),setTimeout(()=>{const m=document.getElementById("loader");m==null||m.classList.add("fadeOut")},650),setTimeout(()=>{l(!1)},750)),(f=s.user)!=null&&f.id&&(setTimeout(()=>{const m=document.getElementById("loader");m==null||m.classList.add("fadeOut")},650),setTimeout(()=>{l(!1)},750),y(!0))},p=()=>{const t=document.getElementById("popup");t==null||t.classList.add("fadeOut"),setTimeout(()=>{x("/")},300);const n=document.querySelector("section");n==null||n.classList.remove("blur")};return e.jsxs(e.Fragment,{children:[I?e.jsx(N,{}):e.jsx(e.Fragment,{}),w?e.jsx(S,{message:e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"You are now registered!"}),e.jsx("p",{children:"Before you can sign in, you will need to veriy your email by clicking the:"}),e.jsx("p",{children:e.jsx("span",{children:'"Confirm your mail"'})}),e.jsx("p",{children:"link in the email we sent from The Stitch Marker Assistant!"})]}),onClose:p}):e.jsx(e.Fragment,{}),e.jsxs("section",{className:"firstView",children:[e.jsx(T,{}),e.jsxs("form",{children:[e.jsx("h5",{children:"Name"}),e.jsx("input",{type:"text",name:"username",id:"regNameInput",value:r.username,onChange:u}),e.jsx("h5",{children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"regEmailInput",value:r.email,onChange:u}),e.jsx("h5",{children:"Password (minimum 6 char)"}),e.jsx("input",{type:"password",name:"password",id:"regPasswordInput",value:r.password,onChange:u}),e.jsx("p",{id:"errorMsg"})]}),e.jsxs("div",{className:"primaryBtnContainer",children:[E?e.jsx(g,{bgColor:"secondary",onClick:h,children:e.jsx(e.Fragment,{children:"Register"})}):e.jsx(g,{bgColor:"disabled",onClick:h,children:e.jsx(e.Fragment,{children:"Register"})}),e.jsx(g,{bgColor:"return",onClick:p,children:e.jsx(e.Fragment,{children:"Return"})})]})]})]})};export{q as NewUserForm};
