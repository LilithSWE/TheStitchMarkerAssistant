import{r as g,P as Z,a as N,j as e,u as Q,b as A}from"./index-DBiGbhcg.js";import{B as d}from"./Button-Cq6hTME8.js";import{H as O}from"./HeaderSmall-DVan3fZi.js";import{s as F}from"./supabaseClient-D0YvXYgE.js";import{P as q}from"./PopUp-CbZ6chGu.js";import{L as Y}from"./Loader-B3sZb3M8.js";const K=({partId:a,row:t})=>{const m=g.useContext(Z),_=g.useContext(N),x=i=>{const{name:u,value:c}=i.target;C(u,c)},C=(i,u)=>{let c={...m,parts:m.parts.map(v=>v.part_id===a?{...v,rows:v.rows.map(n=>n.row_start===t.row_start?{...n,[i]:u}:n)}:v)};i==="amount_of_rows"&&(c=h(c)),_({type:"UPDATE",payload:c})},h=i=>{const c=i.parts.filter(n=>n.part_id===a)[0].rows;for(let n=0;n<c.length;n++){const P=c[n];n===0?P.row_start=1:P.row_start=c[n-1].row_start+c[n-1].amount_of_rows}return{...i,parts:i.parts.map(n=>n.part_id===a?{...n,rows:c}:n)}},w=()=>{const i=t.amount_of_rows+1;C("amount_of_rows",i)},f=()=>{if(t.amount_of_rows>1){const i=t.amount_of_rows-1;C("amount_of_rows",i)}},y=()=>{const c=m.parts.filter(n=>n.part_id===a)[0].rows.filter(n=>n.row_start!==t.row_start);let v={...m,parts:m.parts.map(n=>n.part_id===a?{...n,rows:c}:n)};v=h(v),_({type:"UPDATE",payload:v})};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"newRowContainer",children:[e.jsxs("form",{children:[e.jsxs("h4",{children:["Row ",t.row_start]}),e.jsx("h5",{children:"Instructions"}),e.jsx("input",{type:"text",name:"instructions",id:"rowInstructionInput",value:t.instructions,onChange:x})]}),e.jsxs("div",{className:"newRowCounterContainer",children:[e.jsx("h5",{children:"Repeat for"}),e.jsx(d,{bgColor:"primary plus",onClick:w,children:e.jsx(e.Fragment,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"40px",viewBox:"0 -960 960 960",width:"40px",fill:"#currentColor",children:e.jsx("path",{d:"M446.67-446.67H200v-66.66h246.67V-760h66.66v246.67H760v66.66H513.33V-200h-66.66v-246.67Z"})})})}),e.jsx("div",{className:"count",children:e.jsx("p",{children:t.amount_of_rows})}),e.jsx(d,{bgColor:"secondary minus",onClick:f,children:e.jsx(e.Fragment,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"40px",viewBox:"0 -960 960 960",width:"40px",fill:"#currentcolor",children:e.jsx("path",{d:"M200-446.67v-66.66h560v66.66H200Z"})})})})]}),e.jsx(d,{bgColor:"return",onClick:y,children:e.jsx(e.Fragment,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"#currentcollor",children:e.jsx("path",{d:"M267.33-120q-27.5 0-47.08-19.58-19.58-19.59-19.58-47.09V-740H160v-66.67h192V-840h256v33.33h192V-740h-40.67v553.33q0 27-19.83 46.84Q719.67-120 692.67-120H267.33Zm425.34-620H267.33v553.33h425.34V-740Zm-328 469.33h66.66v-386h-66.66v386Zm164 0h66.66v-386h-66.66v386ZM267.33-740v553.33V-740Z"})})})})]}),e.jsx("div",{className:"rowdivider"})]})},W=({part:a})=>{const t=g.useContext(Z),m=g.useContext(N),_=h=>{const{name:w,value:f}=h.target,y={...t,parts:t.parts.map(i=>i.part_id===a.part_id?{...i,[w]:f}:i)};m({type:"UPDATE",payload:y})},x=()=>{const h=a.rows.length-1,w=a.rows[h].row_start+a.rows[h].amount_of_rows,f={...t,parts:t.parts.map(y=>y.headline===a.headline?{...y,rows:[...y.rows,{row_start:w,instructions:"",amount_of_rows:1}]}:a)};m({type:"UPDATE",payload:f})},C=()=>{const h=t.parts.filter(f=>f.part_id!==a.part_id),w={...t,parts:h};m({type:"UPDATE",payload:w})};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{children:[e.jsx("h4",{children:"Part Headline"}),e.jsx("input",{type:"text",name:"headline",value:a.headline,onChange:_}),e.jsx("h5",{children:"Notes"}),e.jsx("input",{type:"text",name:"notes",value:a.notes,onChange:_})]}),e.jsx("div",{className:"rowdivider"}),a.rows.map((h,w)=>e.jsx(e.Fragment,{children:e.jsx(K,{partId:a.part_id,row:h},w)})),e.jsxs("div",{className:"newRowBtnContainer",children:[e.jsx(d,{children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"40px",viewBox:"0 -960 960 960",width:"40px",fill:"#currentColor",children:e.jsx("path",{d:"M446.67-446.67H200v-66.66h246.67V-760h66.66v246.67H760v66.66H513.33V-200h-66.66v-246.67Z"})}),e.jsx("p",{children:"New Row"})]}),bgColor:"tetriary",onClick:x}),e.jsx(d,{children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"#currentcollor",children:e.jsx("path",{d:"M267.33-120q-27.5 0-47.08-19.58-19.58-19.59-19.58-47.09V-740H160v-66.67h192V-840h256v33.33h192V-740h-40.67v553.33q0 27-19.83 46.84Q719.67-120 692.67-120H267.33Zm425.34-620H267.33v553.33h425.34V-740Zm-328 469.33h66.66v-386h-66.66v386Zm164 0h66.66v-386h-66.66v386ZM267.33-740v553.33V-740Z"})}),e.jsx("p",{children:"Delete Part"})]}),bgColor:"return",onClick:C})]}),e.jsx("div",{className:"divider"})]})},te=()=>{var k;const a=Q(),t=g.useContext(Z),m=g.useContext(N),[_,x]=g.useState(!1),[C,h]=g.useState(!1),[w,f]=g.useState(t.type||"knitting"),y=(k=t.img)==null?void 0:k.replace("./images/",""),[i,u]=g.useState("I have no more info.."),{newPattern:c}=A(),[v,n]=g.useState(!1);g.useEffect(()=>{const s=document.getElementById("patternFormContainer");s==null||s.classList.add("fadeOut"),setTimeout(()=>{s==null||s.classList.remove("fadeOut"),s==null||s.classList.add("fadeIn")},100)},[]);const P=()=>{let s=!0,o=Math.floor(Math.random()*1e3)+1;for(;s;)o=Math.floor(Math.random()*1e3)+1,s=E(o);return o},E=s=>(t.parts.forEach(o=>{if(o.part_id===s)return!0}),!1),B=s=>{m({type:"UPDATE",payload:{...t,[s.target.name]:s.target.value}})},T=()=>{t.pattern_id?setTimeout(()=>{a("/pattern/"+t.pattern_id)},300):setTimeout(()=>{a("/patterns")},300)},R=()=>{const s=document.querySelector("section");s==null||s.classList.remove("blur");const o=document.getElementById("popup");o==null||o.classList.add("fadeOut"),setTimeout(()=>{n(!1),x(!1)},300)},L=()=>{const s=document.querySelector("section");s==null||s.classList.remove("blur");const o=document.getElementById("popup");o==null||o.classList.add("fadeOut"),setTimeout(()=>{a("/patterns"),h(!1)},300)},V=()=>{console.log("clicked 'Upload Img'!")},H=s=>{f(s),t.type=s},D=()=>{const s={...t,parts:[...t.parts,{part_id:P(),headline:"",img:"",notes:"",rows:[{row_start:1,instructions:"",amount_of_rows:1}]}]};m({type:"UPDATE",payload:s})},I=()=>{const s=t.parts.some(o=>o.rows.some(b=>!b.instructions||b.instructions===""));return!t.headline||t.headline===""?(u("You need to give the pattern a name before you save it."),x(!0),!1):t.parts.length===0?(u("Your pattern needs at least one part before you save it."),x(!0),!1):s?(u("You have rows without instructios in them. Please edit this before saving."),x(!0),!1):((t.img==="./images/knitting.png"||t.img==="./images/crochet.png")&&(t.type==="knitting"?t.img="./images/knitting.png":t.type==="crochet"&&(t.img="./images/crochet.png")),!0)},U=async()=>{n(!0);const s=async j=>{const{data:r,error:p}=await F.from("Patterns").insert([{user_id:j,headline:t.headline,img:t.img,notes:t.notes,type:t.type}]).select();return p&&console.error(p),r?r.map(l=>({created_at:l.created_at,headline:l.headline,img:l.img,notes:l.notes,pattern_id:l.pattern_id,type:l.type,user_id:l.user_id})):[]},o=async j=>{const r=async p=>{const{data:l,error:S}=await F.from("Parts").upsert([{user_id:j.user_id,pattern_id:j.pattern_id,part_id:p.part_id,headline:p.headline,img:p.img,notes:p.notes,rows:p.rows}]);S&&console.error(S),l&&console.log(l)};t.parts.forEach(p=>{r(p)})},b=async j=>{const{data:r,error:p}=await F.from("Patterns").update({headline:t.headline,img:t.img,notes:t.notes,type:t.type}).eq("user_id",j).eq("pattern_id",t.pattern_id).select();return p&&console.log(p),r?r.map(l=>({created_at:l.created_at,headline:l.headline,img:l.img,notes:l.notes,pattern_id:l.pattern_id,type:l.type,user_id:l.user_id})):[]};let M=!1;if(M=I(),M){const j=localStorage.getItem("user_id");if(!j){console.error("User ID not found in localStorage");return}if(c==="true"){try{const r=await s(j);r.length>0&&await o(r[0])}catch(r){u("something went wrong while saving the pattern. Please try again later."),x(!0),console.error("Error saving pattern and parts:",r)}setTimeout(()=>{const r=document.getElementById("loader");r==null||r.classList.add("fadeOut")},650),setTimeout(()=>{n(!1)},750),h(!0)}else if(c==="false"){try{const r=await b(j);r.length>0&&await o(r[0])}catch(r){u("something went wrong while saving the pattern. Please try again later."),x(!0),console.error("Error saving pattern and parts:",r)}setTimeout(()=>{const r=document.getElementById("loader");r==null||r.classList.add("fadeOut")},650),setTimeout(()=>{n(!1)},750),h(!0)}else u("something went wrong while saving the pattern. Please try again later."),x(!0),setTimeout(()=>{const r=document.getElementById("loader");r==null||r.classList.add("fadeOut")},650),setTimeout(()=>{n(!1)},750)}};return e.jsxs(e.Fragment,{children:[v?e.jsx(Y,{}):e.jsx(e.Fragment,{}),_?e.jsx(q,{message:e.jsx("h3",{children:i}),onClose:R}):e.jsx(e.Fragment,{}),C?e.jsx(q,{message:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"currentcolor",children:e.jsx("path",{d:"M840-682v495.33q0 27-19.83 46.84Q800.33-120 773.33-120H186.67q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840H682l158 158Zm-66.67 29.33L652.67-773.33h-466v586.66h586.66v-466ZM479.84-243.33q45.49 0 77.49-31.85 32-31.84 32-77.33 0-45.49-31.84-77.49-31.84-32-77.33-32-45.49 0-77.49 31.84-32 31.85-32 77.34t31.84 77.49q31.84 32 77.33 32ZM235.33-576H594v-148.67H235.33V-576Zm-48.66-76.67v466-586.66 120.66Z"})}),e.jsx("h4",{children:"Your pattern is saved!"})]}),onClose:L}):e.jsx(e.Fragment,{}),e.jsx(O,{bgColor:"secondary formHeader"}),e.jsxs("section",{className:"secondView",children:[c==="true"?e.jsx("h2",{children:"New Pattern"}):e.jsx("h2",{children:"Edit Pattern"}),e.jsxs("section",{className:"patternFormContainer",id:"patternFormContainer",children:[e.jsx(d,{children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"currentcolor",children:e.jsx("path",{d:"M359.33-240 120-479.33l239.33-239.34 47.34 47.34L247.33-512h526v-168H840v234H248l158.67 158.67L359.33-240Z"})}),e.jsx("p",{children:"Return Without Saving"})]}),bgColor:"return",onClick:T}),e.jsxs("form",{children:[e.jsx("h4",{children:"Pattern Headline"}),e.jsx("input",{type:"text",name:"headline",value:t.headline,onChange:B}),e.jsx("h5",{children:"Notes"}),e.jsx("input",{type:"text",name:"notes",value:t.notes,onChange:B})]}),e.jsxs("section",{className:"imageUploadContainer",children:[e.jsx("h5",{children:"Image"}),e.jsx("p",{className:"imgName",children:y}),e.jsx(d,{children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"#currentcollor",children:e.jsx("path",{d:"M186.67-120q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840h586.66q27 0 46.84 19.83Q840-800.33 840-773.33v586.66q0 27-19.83 46.84Q800.33-120 773.33-120H186.67Zm0-66.67h586.66v-586.66H186.67v586.66ZM237.33-278h486l-148-197.33-128 167.33-92-124.67-118 154.67Zm-50.66 91.33v-586.66 586.66Z"})}),e.jsx("p",{children:"Upload Image"})]}),bgColor:"secondary",onClick:V})]}),e.jsx("h5",{children:"Type"}),e.jsx("section",{className:"typeBtnContainer",children:w==="knitting"?e.jsxs(e.Fragment,{children:[e.jsx(d,{bgColor:"primary",onClick:()=>H("knitting"),children:e.jsx(e.Fragment,{children:"Knitting"})}),e.jsx(d,{bgColor:"grey",onClick:()=>H("crochet"),children:e.jsx(e.Fragment,{children:"Crochet"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{bgColor:"grey",onClick:()=>H("knitting"),children:e.jsx(e.Fragment,{children:"Knitting"})}),e.jsx(d,{bgColor:"primary",onClick:()=>H("crochet"),children:e.jsx(e.Fragment,{children:"Crochet"})})]})}),e.jsx("section",{className:"patterFormPartsContainer",children:t.parts.map((s,o)=>e.jsx(W,{part:s},o))}),e.jsx(d,{bgColor:"secondary",onClick:D,children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"40px",viewBox:"0 -960 960 960",width:"40px",fill:"#currentColor",children:e.jsx("path",{d:"M446.67-446.67H200v-66.66h246.67V-760h66.66v246.67H760v66.66H513.33V-200h-66.66v-246.67Z"})}),e.jsx("p",{children:"New Part"})]})}),e.jsxs("div",{className:"primaryBtnContainer",children:[e.jsx(d,{children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"currentcolor",children:e.jsx("path",{d:"M840-682v495.33q0 27-19.83 46.84Q800.33-120 773.33-120H186.67q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840H682l158 158Zm-66.67 29.33L652.67-773.33h-466v586.66h586.66v-466ZM479.84-243.33q45.49 0 77.49-31.85 32-31.84 32-77.33 0-45.49-31.84-77.49-31.84-32-77.33-32-45.49 0-77.49 31.84-32 31.85-32 77.34t31.84 77.49q31.84 32 77.33 32ZM235.33-576H594v-148.67H235.33V-576Zm-48.66-76.67v466-586.66 120.66Z"})}),e.jsx("p",{children:"Save Pattern"})]}),bgColor:"primary",onClick:U}),e.jsx(d,{children:e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"35px",viewBox:"0 -960 960 960",width:"35px",fill:"currentcolor",children:e.jsx("path",{d:"M359.33-240 120-479.33l239.33-239.34 47.34 47.34L247.33-512h526v-168H840v234H248l158.67 158.67L359.33-240Z"})}),e.jsx("p",{children:"Return Without Saving"})]}),bgColor:"return",onClick:T})]})]})]})]})};export{te as PatternForm};
