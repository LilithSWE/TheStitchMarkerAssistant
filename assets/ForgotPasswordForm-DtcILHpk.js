import{u as v,r as i,j as e}from"./index-DznQeCRK.js";import{B as l}from"./Button-CH3jPwDT.js";import{L}from"./Loader-BbqsgfMp.js";import{P as B}from"./PopUp-ryFyMstl.js";import{H as F}from"./Headline-DLSfA51M.js";import{s as w}from"./supabaseClient-BG7qJxoN.js";import{v as _}from"./validatePassword-5G1YVJAs.js";const V=()=>{const x=v(),n=document.getElementById("errorMsg"),[a,j]=i.useState({password:"",passwordRetyped:""}),[y,k]=i.useState(!1),[P,p]=i.useState(!1),[C,c]=i.useState(!0),[u,R]=i.useState(""),[S,T]=i.useState("");i.useEffect(()=>{const s=window.location.hash,[r,t]=s.split("#").slice(1);if(console.log(r),t){const o=new URLSearchParams(t),d=o.get("access_token"),h=o.get("refresh_token");d&&R(d),h&&T(h)}},[]);const b=async s=>{if(u){p(!0);const{data:o,error:d}=await w.auth.setSession({access_token:u,refresh_token:S});d?console.error("Error setting session:",d):(o.user&&localStorage.setItem("user_id",o.user.id),console.error("Successfull in setting session:",o))}else{console.error("Can't find access_token data"),n&&(n.innerText="Can't find access_token data... please try resetting your password again and follow the new link.");return}const{data:r,error:t}=await w.auth.updateUser({password:s});setTimeout(()=>{const o=document.getElementById("loader");o==null||o.classList.add("fadeOut")},650),setTimeout(()=>{p(!1)},750),t&&console.error("Error sending password reset email:",t.message),r&&k(!0)},I=(s,r)=>{if(n){if(r&&s)return;if(c(!1),!s){n.innerText="Make sure your new password is at least 6 char long.";const t=document.getElementById("passwordInput");t==null||t.classList.add("error")}if(!r){n.innerText="The passwords don't match, try again.";const t=document.getElementById("retypePasswordInput");t==null||t.classList.add("error")}}},m=s=>{j({...a,[s.target.name]:s.target.value}),s.target.classList.remove("error"),c(!0)},E=(s,r)=>s===r,f=()=>{const s=_(a.password),r=E(a.password,a.passwordRetyped);(a.password===""||a.passwordRetyped==="")&&(c(!1),n&&(n.innerText="Please write something in the fields above before attempting to submit.")),I(s,r),r&&s&&b(a.password)},g=()=>{const s=document.getElementById("popup");s==null||s.classList.add("fadeOut"),setTimeout(()=>{x("/")},300)};return e.jsxs(e.Fragment,{children:[P?e.jsx(L,{}):e.jsx(e.Fragment,{}),y?e.jsx(B,{message:e.jsx("p",{children:"Your password has been updated."}),onClose:g}):e.jsx(e.Fragment,{}),e.jsxs("section",{className:"firstView",children:[e.jsx(F,{}),e.jsxs("form",{children:[e.jsx("h5",{children:"Password (minimum 6 char)"}),e.jsx("input",{type:"password",name:"password",id:"passwordInput",value:a.password,onChange:m}),e.jsx("h5",{children:"Retype Password"}),e.jsx("input",{type:"password",name:"passwordRetyped",id:"retypePasswordInput",value:a.passwordRetyped,onChange:m}),e.jsx("p",{id:"errorMsg"})]}),e.jsx("p",{className:"headlineSpacing",id:"errorMsg"}),e.jsxs("div",{className:"primaryBtnContainer",children:[C?e.jsx(l,{bgColor:"secondary",onClick:f,children:e.jsx(e.Fragment,{children:"Register New Password"})}):e.jsx(l,{bgColor:"disabled",onClick:f,children:e.jsx(e.Fragment,{children:"Register New Password"})}),e.jsx(l,{bgColor:"return",onClick:g,children:e.jsx(e.Fragment,{children:"Return"})})]})]})]})};export{V as ForgotPasswordForm};
